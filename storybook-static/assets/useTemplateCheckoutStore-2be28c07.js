import{gX as h,w as u,ac as g,an as l,h as p,eK as k,eL as I,E as d,o as v}from"./ModalPvLimitAlertView-cb9178ae.js";const f=()=>h(async(t,e)=>{const{templateId:a,couponCode:s}=t;return(await u.postStoreTemplateCheckout(a,s,{cancelToken:e})).data},()=>({data:{projectId:""}})),E={templateId:void 0,coverUrl:void 0,templateTitle:void 0,templateDescription:void 0,imageUrls:[],category:void 0,tags:[],functions:[],tier:void 0,storeLanguage:void 0,createdAt:void 0,updatedAt:void 0,publishedAt:void 0,templateDesigner:{avatarUrl:"",contactEmail:"",displayName:"",portfolioUrl:"",profile:"",templateDesignerId:""}},j=()=>h(async(t,e)=>{const{templateId:a}=t,r=(await u.getStoreTemplate(a,{cancelToken:e})).data.data;if(!r)throw new Error("/v2/store/templates/{template_id} response undefined returned");return r},()=>E),w=g("useTemplateCheckoutStore",{state:()=>({template:null,checkoutProgress:"none",parchasingErrorMessage:"",initializingErrorMessage:"",projectId:""}),actions:{async onCheckoutCompleted(t){try{const e=t.data?.projectId,a=t.data?.cmsProjectId;if(!e)throw new Error("projectId is not defined");if(this.projectId=e,this.checkoutProgress="initializing-project",await l.dispatch("accountProject/projectDetailInitialize",{projectId:e}),this.template?.templateId&&p.projectCreated({projectId:e,templateId:this.template.templateId}),a){this.checkoutProgress="initializing-cms";const s=(await k.createToken(e)).data.token;await l.dispatch("database/connectFirebase",{token:s,projectId:e});const r=await I({path:{cmsId:a},subscribe:i=>{i.initializing===!1&&r()},isTemplate:!1})}}catch(e){console.error(e),this.initializingErrorMessage=d(e)}finally{this.checkoutProgress="none"}},async checkout(t,e,a){const{category:s,templateId:r,tier:i}=t,{result:n,load:m,error:c}=f();try{if(!r)throw new Error("templateId is not exist in Template");if(this.template=t,this.checkoutProgress="purchasing",this.parchasingErrorMessage="",await m({templateId:r,couponCode:a}),c.value)throw c.value;const o=n.value.data?.projectId;o&&p.templatePurchased({projectId:o,category:s,templateId:r,tier:i}),await this.router.replace({name:"PageTemplateCheckoutCompleted"}),this.onCheckoutCompleted(n.value)}catch(o){v.isAxiosError(o)&&o.response?.status===400?this.parchasingErrorMessage=e("STUDIO_STORE_Payment:checkout.error.allready_purchased"):this.parchasingErrorMessage=d(c.value),this.checkoutProgress="none";return}},resetCheckoutProgress(){this.checkoutProgress="none",this.parchasingErrorMessage="",this.initializingErrorMessage=""}}});export{w as a,j as u};
