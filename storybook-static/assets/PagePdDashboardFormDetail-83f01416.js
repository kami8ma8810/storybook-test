import{f as _,O as f,a7 as U,H as s,K as o,Q as p,J as m,_ as q,G as r,L as w,M as B,x as V,e as k,N as y,F,Z as C,S as u,R as b,U as S,V as j,a8 as T}from"./vue.esm-bundler-33967e91.js";import{e$ as H,f0 as g,f1 as G,bz as K,fb as z,E as P,f2 as X,f3 as W,a_ as v,f8 as Z,f6 as R,fa as N}from"./ModalPvLimitAlertView-cb9178ae.js";import{_ as D}from"./_plugin-vue_export-helper-c27b6911.js";import{B as J,u as Q}from"./textToLink-27c7a369.js";import{B as Y}from"./BasicModal-000dc82b.js";import"./vue-i18n.cjs-bd62fc86.js";import"./_commonjsHelpers-042e6b4d.js";import"./ModalUpgradeRequired-a455cfd7.js";import"./PfButton-db6d6722.js";import"./PfIconContext-bd54ca9b.js";import"./lodash-bf1bac5c.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./iframe-4066d2cc.js";import"../sb-preview/runtime.js";import"./PfIcon-bb1c3c10.js";import"./mapValues-a1d744f5.js";const O=_({components:{SvgElement:H},props:{projectId:{type:String,required:!0},formId:{type:String,required:!0},value:{type:Object,required:!0}},data(){return{loadingIcon:!1,loadingDownload:!1,loadingFailed:!1,fileUri:null}},computed:{svgNameByFileType(){if(!g(this.value))return"";const e=this.value.type;return X(e)},fileShortName(){return G(this.value.name)},byteSize(){return x(this.value.size)},isImgTagSupportedImageFormat(){return K(this.value.type)},hasUrl(){return!!this.value.url}},async created(){try{this.loadingIcon=!0,await this.setBlobUrl()}catch(e){console.log(e),this.loadingFailed=!0}finally{this.loadingIcon=!1}},beforeUnmount(){this.revokeBlobUrl()},methods:{async setBlobUrl(){if(this.revokeBlobUrl(),!this.hasUrl)return;const e=await this.$store.dispatch("projectForm/getProjectFormFile",{projectId:this.projectId,formId:this.formId,fileUri:this.value.url});if(!e.ok)throw new Error(`${e.status} ${e.statusText}`);const t=await e.blob();this.fileUri=URL.createObjectURL(t)},revokeBlobUrl(){this.hasUrl&&this.fileUri&&URL.revokeObjectURL(this.fileUri)},async onClickPreview(){if(z(this.value.type)){window.open(this.fileUri);return}this.onClickDownload()},async onClickDownload(){try{this.loadingDownload=!0,await this.setBlobUrl();const e=document.createElement("a");this.$refs.rootRef.appendChild(e),e.download=this.value.name,e.href=this.fileUri,e.click(),e.remove()}catch(e){const t=this.$t(P(e));this.$notify({type:"error",text:t,duration:1e4})}finally{this.loadingDownload=!1}}}}),x=e=>{if(!e)return"0B";const i=[{from:1,to:1e3,unit:"B"},{from:1e3,to:1e6,unit:"kB"},{from:1e6,to:1e9,unit:"MB"},{from:1e9,to:1e12,unit:"GB"},{from:1e12,to:1e15,unit:"TB"},{from:1e15,to:1e18,unit:"PB"},{from:1e18,to:1e21,unit:"EB"},{from:1e21,to:1e24,unit:"ZB"},{from:1e24,to:1e27,unit:"YB"}].find(n=>n.from<e&&e<n.to);return`${Math.round(10*e/i.from)/10}${i?.unit}`||"0B"};const E=e=>(w("data-v-b9e82ee9"),e=e(),B(),e),ee={ref:"rootRef",class:"FormDetailItemFileRender"},te=["disabled"],re={class:"icon-wrap"},se={key:0,class:"loading"},oe=E(()=>o("div",{class:"spinner black"},null,-1)),ae=[oe],ie=["src"],ne={class:"text-wrap"},de={class:"file-name"},le={class:"file-size"},ce=["disabled"],me={key:0,class:"loading"},ue=E(()=>o("div",{class:"spinner black"},null,-1)),pe=[ue],he={key:1,class:"material-icons"};function fe(e,t,i,n,c,I){const d=f("SvgElement"),h=U("tooltip");return r(),s("div",ee,[o("a",{class:"btn-preview",disabled:e.loadingIcon||e.loadingDownload||e.loadingFailed,onClick:t[0]||(t[0]=(...l)=>e.onClickPreview&&e.onClickPreview(...l))},[o("div",re,[e.isImgTagSupportedImageFormat&&e.loadingIcon?(r(),s("div",se,ae)):e.isImgTagSupportedImageFormat&&e.hasUrl&&e.fileUri?(r(),s("img",{key:1,src:e.fileUri},null,8,ie)):(r(),p(d,{key:2,name:e.svgNameByFileType,height:"26"},null,8,["name"]))]),o("div",ne,[o("p",de,m(e.fileShortName),1),o("p",le,m(e.byteSize),1)])],8,te),q((r(),s("div",{class:"btn-download",disabled:e.loadingDownload,onClick:t[1]||(t[1]=(...l)=>e.onClickDownload&&e.onClickDownload(...l))},[e.loadingDownload?(r(),s("div",me,pe)):(r(),s("i",he,"save_alt"))],8,ce)),[[h,e.$t("TOOLTIP:FILE_DOWNLOAD"),void 0,{top:!0}]])],512)}const Ie=D(O,[["render",fe],["__scopeId","data-v-b9e82ee9"]]);O.__docgenInfo={exportName:"default",displayName:"FormDetailItemFileRender",description:"",tags:{},props:[{name:"projectId",type:{name:"string"},required:!0},{name:"formId",type:{name:"string"},required:!0},{name:"value",type:{name:"FormFile"},required:!0}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/Pd/PdDashboard/PageForms/FormDetail/FormDetailItemFileRender.vue"]};const M=_({name:"FormDetailItemStringRender",components:{Badge:J},props:{value:{type:String,required:!0},type:{type:String,required:!0}},setup(e){const{value:t,type:i}=V(e),{textToLink:n}=Q(),c=k(()=>["RADIO","CHECKBOX","SELECT"].includes(i.value)),I=k(()=>i.value==="EMAIL"&&W(t.value)),d=k(()=>Array.isArray(t.value)||g(t.value)?!1:i.value==="CHECKBOX"&&["on",""].includes(t.value));return{isBadgeItem:c,isEmail:I,isSingleCheckbox:d,textToLink:n}}});const ge=e=>(w("data-v-568c7a19"),e=e(),B(),e),ve={class:"FormDetailItemStringRender"},ye={key:0},Fe=ge(()=>o("i",{class:"material-icons"},"check",-1)),_e=[Fe],De=["href"],$e=["innerHTML"];function ke(e,t,i,n,c,I){const d=f("Badge");return r(),s("div",ve,[e.isSingleCheckbox?(r(),s("div",ye,[o("span",{class:y(["checkbox-parts",{checked:e.value==="on"}])},_e,2)])):e.isBadgeItem?(r(),p(d,{key:1,label:e.value},null,8,["label"])):e.isEmail?(r(),s("a",{key:2,class:"text",href:`mailto:${e.value}`},m(e.value),9,De)):(r(),s("p",{key:3,class:"text",innerHTML:e.textToLink(e.value)},null,8,$e))])}const be=D(M,[["render",ke],["__scopeId","data-v-568c7a19"]]);M.__docgenInfo={displayName:"FormDetailItemStringRender",exportName:"default",description:"",tags:{},props:[{name:"value",type:{name:"string"},required:!0},{name:"type",type:{name:"DataType"},required:!0}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/Pd/PdDashboard/PageForms/FormDetail/FormDetailItemStringRender.vue"]};const L=_({components:{FormDetailItemFileRender:Ie,FormDetailItemStringRender:be},props:{projectId:{type:String,required:!0},formId:{type:String,required:!0},recordDataItem:{type:Object,required:!1,default:null},column:{type:Object,required:!0}},computed:{isString(){return v(this.recordDataItem.val)},isMultiple(){return Array.isArray(this.recordDataItem.val)},isFile(){return g(this.recordDataItem.val)},recordDataItemValString(){return v(this.recordDataItem.val)?this.recordDataItem.val:""},recordDataItemValArray(){return Array.isArray(this.recordDataItem.val)?this.recordDataItem.val:[]},recordDataItemValFile(){return g(this.recordDataItem.val)?this.recordDataItem.val:null}},methods:{isStringContent(e){return v(e)},getTypeBycontent(e){return v(e)?"TEXT":g(e)?"FILE":"TEXT"}}});const Se={class:"FormDetailItem"},Re={key:1,class:"fields"},Ce=["data-type"],Pe={key:1,class:"no-data"};function we(e,t,i,n,c,I){const d=f("FormDetailItemStringRender"),h=f("FormDetailItemFileRender");return r(),s("div",Se,[e.recordDataItem&&e.recordDataItem.val?(r(),s(F,{key:0},[e.isString?(r(),p(d,{key:0,type:e.recordDataItem.type,value:e.recordDataItemValString},null,8,["type","value"])):e.isMultiple?(r(),s("div",Re,[(r(!0),s(F,null,C(e.recordDataItemValArray,(l,a)=>(r(),s("div",{key:a,class:"field","data-type":e.getTypeBycontent(l)},[e.isStringContent(l)?(r(),p(d,{key:0,value:l,type:e.recordDataItem.type},null,8,["value","type"])):(r(),p(h,{key:1,value:l,"project-id":e.projectId,"form-id":e.formId},null,8,["value","project-id","form-id"]))],8,Ce))),128))])):e.isFile?(r(),p(h,{key:2,value:e.recordDataItemValFile,"project-id":e.projectId,"form-id":e.formId},null,8,["value","project-id","form-id"])):u("",!0)],64)):(r(),s("p",Pe,"-"))])}const Be=D(L,[["render",we],["__scopeId","data-v-e04e0adf"]]);L.__docgenInfo={exportName:"default",displayName:"FormDetailItem",description:"",tags:{},props:[{name:"projectId",type:{name:"string"},required:!0},{name:"formId",type:{name:"string"},required:!0},{name:"recordDataItem",type:{name:"FormRecordDataItem"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"column",type:{name:"FormColumn"},required:!0}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/Pd/PdDashboard/PageForms/FormDetail/FormDetailItem.vue"]};const A=_({components:{FormDetailItem:Be,BasicModal:Y},props:{projectId:{type:String,required:!0},formId:{type:String,required:!0},recordId:{type:String,required:!0},statuses:{type:Array}},data(){return{backNext:null,isFocus:!1,isMenuOpened:!1}},computed:{form(){return this.$store.getters["projectForm/getFormById"](this.formId)},filteredRecords(){return this.$store.getters["projectForm/getFilterdRecordsBySelectedFormId"]},columns(){return this.form.columns},record(){return(this.form?.records).find(i=>i.recordId===this.recordId)},currentRecordIndex(){return this.filteredRecords.findIndex(e=>e.recordId===this.recordId)},prevRecord(){return this.filteredRecords[this.currentRecordIndex-1]},nextRecord(){return this.filteredRecords[this.currentRecordIndex+1]},menuOptions(){const e=this.form.statusChanged?this.statuses:Z();return[R(),...e,N()]},selectedStatusId(){if(!this.record)return"";if(this.record.isTrashed)return"trash";const e=this.statuses.find(t=>t.id===this.record.statusId);return this.statuses.some(t=>t.id===e?.id)&&e?.id||""},selectedStatusName(){return this.record?this.record.isTrashed?N().name:this.record.statusId===""?R().name:this.statuses.some(t=>t.id===this.record.statusId)?this.statuses.find(t=>t.id===this.record.statusId)?.name||"":R().name:""}},watch:{formId(e,t){this.backNext=null,this.setFocus()},$route:{handler(e,t){const i=this.filteredRecords.findIndex(c=>c.recordId===e.params.recordId),n=this.filteredRecords.findIndex(c=>c.recordId===t.params.recordId);i>n?this.backNext="next":this.backNext="back"},deep:!0}},mounted(){this.$modal.push("PagePdDashboardFormDetail"),this.$store.dispatch("wootric/setTheFlagIfRequirementsWereSatisfied","Dashboard Form Check")},methods:{setFocus(){this.$refs.PagePdDashboardFormDetail?.focus()},onClose(){this.$route?.params?.recordId&&(this.$router.push({name:"PagePdDashboardFormList",params:{formId:this.formId}}),this.$store.dispatch("wootric/run",{surveyTrigger:"Dashboard Form Check"}))},prev(){this.prevRecord&&(this.backNext="back",this.$router.push({name:"PagePdDashboardFormDetail",params:{recordId:this.prevRecord.recordId}}))},next(){this.nextRecord&&(this.backNext="next",this.$router.push({name:"PagePdDashboardFormDetail",params:{recordId:this.nextRecord.recordId}}))},async handleStatusClick(e){try{await this.$store.dispatch("projectForm/updateProjectFormRecords",{projectId:this.projectId,formId:this.formId,statusId:e,statusChanged:this.form.statusChanged,checkRecordIds:[this.recordId]}),this.isMenuOpened=!1}catch(t){const i=this.$t(P(t));this.$notify({type:"error",text:i,duration:1e4})}},async handleRecordsDeleteClick(){try{await this.$store.dispatch("projectForm/deleteProjectFormRecords",{projectId:this.projectId,formId:this.formId,body:{recordIds:[this.recordId]}}),this.prevRecord?this.prev():this.nextRecord?this.next():this.onClose()}catch(e){console.log(e);const t=this.$t(P(e));this.$notify({type:"error",text:t,duration:1e4})}}}});const $=e=>(w("data-v-cbbce16e"),e=e(),B(),e),je={class:"main-wrap"},Te={class:"main-inner"},Ne={class:"header"},Ue={class:"breadcrumb"},qe={key:0,class:"createdAtString"},Oe={class:"right"},Ee={class:"menu-wrap"},Me={class:"menu-text"},Le=$(()=>o("span",{class:"menu-icon material-icons"}," expand_more ",-1)),Ae={key:0,class:"menu"},Ve=["onClick"],He={class:"text"},Ge={key:0,class:"record"},Ke={class:"name"},ze=$(()=>o("ion-icon",{name:"trash-outline"},null,-1)),Xe={class:"text"},We=$(()=>o("i",{class:"material-icons"},"keyboard_arrow_left",-1)),Ze=[We],Je=$(()=>o("i",{class:"material-icons"},"keyboard_arrow_right",-1)),Qe=[Je];function Ye(e,t,i,n,c,I){const d=f("FormDetailItem"),h=f("BasicModal"),l=U("click-outside");return r(),p(h,{name:"PagePdDashboardFormDetail",onClosed:e.onClose,onOpened:e.setFocus},{default:b(()=>[o("div",{id:"PagePdDashboardFormDetail",ref:"PagePdDashboardFormDetail",tabindex:"1",onFocus:t[4]||(t[4]=a=>e.isFocus=!0),onBlur:t[5]||(t[5]=a=>e.isFocus=!1),onKeyup:[t[6]||(t[6]=T(a=>e.isFocus&&e.next(),["right"])),t[7]||(t[7]=T(a=>e.isFocus&&e.prev(),["left"]))]},[o("div",je,[S(j,{name:"form-detail-main",mode:"out-in"},{default:b(()=>[(r(),s("div",{key:e.recordId,class:y(["main",[e.backNext]])},[o("div",Te,[o("div",Ne,[o("div",Ue,[e.record?(r(),s("div",qe,m(e.record.createdAtString),1)):u("",!0)]),o("div",Oe,[o("div",Ee,[q((r(),s("div",{class:y(["trigger-wrap",{isMenuOpened:e.isMenuOpened}]),onClick:t[0]||(t[0]=a=>e.isMenuOpened=!e.isMenuOpened)},[o("span",Me,m(e.$t(e.selectedStatusName)),1),Le],2)),[[l,()=>e.isMenuOpened=!1]]),S(j,null,{default:b(()=>[e.isMenuOpened?(r(),s("div",Ae,[o("ul",null,[(r(!0),s(F,null,C(e.menuOptions,a=>(r(),s("li",{key:a.id,class:y({selected:e.selectedStatusId===a.id}),onClick:xe=>e.handleStatusClick(a.id)},[o("p",null,[o("span",He,m(e.$t(a.name)),1)])],10,Ve))),128))])])):u("",!0)]),_:1})])])]),e.columns&&e.record?(r(),s("div",Ge,[(r(!0),s(F,null,C(e.columns,a=>(r(),s("div",{key:a.name,class:"item"},[o("span",Ke,m(a.name),1),S(d,{"record-data-item":e.record.dataMap&&e.record.dataMap[a.name],column:a,"project-id":e.projectId,"form-id":e.formId},null,8,["record-data-item","column","project-id","form-id"])]))),128))])):u("",!0),e.record&&e.record.isTrashed?(r(),s("button",{key:1,class:"trash-btn",onClick:t[1]||(t[1]=(...a)=>e.handleRecordsDeleteClick&&e.handleRecordsDeleteClick(...a))},[ze,o("span",Xe,m(e.$t("form: Completely delete")),1)])):u("",!0)])],2))]),_:1})]),e.prevRecord?(r(),s("div",{key:0,class:"prev-button",onClick:t[2]||(t[2]=(...a)=>e.prev&&e.prev(...a))},Ze)):u("",!0),e.nextRecord?(r(),s("div",{key:1,class:"next-button",onClick:t[3]||(t[3]=(...a)=>e.next&&e.next(...a))},Qe)):u("",!0)],544)]),_:1},8,["onClosed","onOpened"])}const It=D(A,[["render",Ye],["__scopeId","data-v-cbbce16e"]]);A.__docgenInfo={exportName:"default",displayName:"PagePdDashboardFormDetail",description:"",tags:{},props:[{name:"projectId",type:{name:"string"},required:!0},{name:"formId",type:{name:"string"},required:!0},{name:"recordId",type:{name:"string"},required:!0},{name:"statuses",type:{name:"ProjectFormStatus[]"}}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/Pd/PdDashboard/PageForms/PagePdDashboardFormDetail.vue"]};export{It as default};
