import{_ as x}from"./iframe-4066d2cc.js";import{T as y,t as P,v as S,w as h,x as w,y as v,z as T}from"./ModalPvLimitAlertView-cb9178ae.js";import{_ as $}from"./Editor-e2ebb077.js";import{O as d,G as _,H as b,F as I,U as m,K as a,J as n,Q as f,R as g,S as k}from"./vue.esm-bundler-33967e91.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";import"../sb-preview/runtime.js";import"./vue-i18n.cjs-bd62fc86.js";import"./_commonjsHelpers-042e6b4d.js";import"./ModalUpgradeRequired-a455cfd7.js";import"./BasicModal-000dc82b.js";import"./PfButton-db6d6722.js";import"./PfIconContext-bd54ca9b.js";import"./lodash-bf1bac5c.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./PfIcon-bb1c3c10.js";import"./mapValues-a1d744f5.js";import"./SelectSwitch-b6107958.js";import"./tiptap-extension-paragraph.esm-72054cce.js";import"./draggable-203bb716.js";import"./ApiIcon-4990672b.js";import"./useSearch-b8b0ad67.js";const E={name:"SandboxEditor",components:{Editor:$,ToolAppearance:y},beforeRouteEnter(t,l,s){s(async p=>{try{await p.loadProduct({templateId:t.params.templateId})}catch(e){console.error(e),s({name:"NotFound",params:[t.path],replace:!0})}})},setup(){return{templatePriceStore:P()}},data(){return{isLoaded:!1,isFree:!1,templateTitle:"",templatePrice:"",PURCHASE_TEMPLATE_QUERY_KEY:S}},computed:{templateId(){return this.$route.params.templateId}},async beforeUnmount(){await this.$store.dispatch("accountProject/clearProjectDetailAll")},methods:{async loadProduct({templateId:t}){const l=this.templatePriceStore,{lang:s,currency:p}=this.$route.query;await this.$store.dispatch("studioSession/init"),await this.$store.dispatch("project/init"),this.$store.commit("database/init",{}),this.$store.commit("project/isSandboxMode",{isSandboxMode:!0});let e;if(t){await l.init();const o=(await h.getStoreTemplate(t)).data.data,c=l.getPriceByTier(o.tier);this.isFree=o.tier===w.Tier_0,this.templateTitle=o.templateTitle,this.templatePrice=p===v.Jpy?c.displayPriceJpy:c.displayPriceUsd;const i=o.versionId,{data:{data:{token:u}}}=await h.getStoreTemplateToken(t);await this.$store.dispatch("database/connectTemplateFirebase",{token:u,templateId:t,versionId:i}),e=(await this.$axios.get(`${this.$store.state.database.versionizedTemplateUrl}/${t}/${i}/design.json`)).data,await this.$store.dispatch("studioProduct/init",{studioProduct:e},{root:!0}),await this.$store.commit("project/SET_DUMMY_PROJECT_INTEGRATIONS",{root:!0}),await this.$store.dispatch("CmsStore/initVersionizedTemplate",{templateId:t,versionId:i},{root:!0})}else e=(await x(()=>import("./blank-ed96cdba.js"),[],import.meta.url)).default,await this.$store.dispatch("studioProduct/init",{studioProduct:e},{root:!0}),await this.$store.commit("project/SET_DUMMY_PROJECT_INTEGRATIONS",{root:!0}),await this.$store.dispatch("CmsStore/init",{isTemplate:!0},{root:!0});if(s){const r=Object.values(T).findIndex(o=>o===s);this.$i18n.locale=(r===-1?s:Object.keys(T)[r]).toUpperCase()}this.isLoaded=!0}}},C={class:"msg-container"},R={class:"msg label-xs-bold"},A={class:"_gap-2_ _flex _flex-col _items-start"},O={class:"label-md-bold _text-const-white"},j={class:"label-xs-bold _text-const-gray-500"},F={class:"_gap-2_ _flex _flex-col _items-start"},N={class:"label-md-bold _text-const-white"},M={class:"label-xs-bold _text-const-gray-500"};function D(t,l,s,p,e,r){const o=d("Editor"),c=d("PfIcon"),i=d("router-link"),u=d("ToolAppearance");return _(),b("div",null,[e.isLoaded?(_(),b(I,{key:0},[m(o,{class:"editor"}),a("div",C,[a("div",R,n(t.$t("sandbox mode: Changes will not be saved. ")),1)]),e.isFree?(_(),f(i,{key:0,to:{name:"PageProjectTemplates",params:{templateId:r.templateId},query:{modal:"create"}},class:"_absolute _right-20 _bottom-20 _z-1 _flex _flex-row _items-center _gap-12 _rounded-[46px] _bg-const-black _py-12 _pl-28 _pr-32 _shadow-16 hover:_bg-const-gray-800"},{default:g(()=>[m(c,{icon:"useForFree",size:"24","icon-color":"const-white"}),a("div",A,[a("span",O,n(t.$t("STUDIO_STORE:start for free")),1),a("span",j,n(e.templateTitle),1)])]),_:1},8,["to"])):(_(),f(i,{key:1,to:{name:"PageTemplateCheckout",params:{templateId:r.templateId},query:{[e.PURCHASE_TEMPLATE_QUERY_KEY]:"true"}},class:"_absolute _right-20 _bottom-20 _z-1 _flex _flex-row _items-center _gap-12 _rounded-[46px] _bg-const-black _py-12 _pl-28 _pr-32 _shadow-16 hover:_bg-const-gray-800"},{default:g(()=>[m(c,{icon:"addcart",size:"24","icon-color":"const-white"}),a("div",F,[a("span",N,n(t.$t("STUDIO_STORE:purchase for",{price:e.templatePrice})),1),a("span",M,n(e.templateTitle),1)])]),_:1},8,["to"]))],64)):k("",!0),m(u)])}const ct=U(E,[["render",D],["__scopeId","data-v-aa8ada90"]]);E.__docgenInfo={displayName:"SandboxEditor",exportName:"default",description:"",tags:{},sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/pages/SandboxEditor.vue"]};export{ct as default};
