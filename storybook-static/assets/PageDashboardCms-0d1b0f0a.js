import{f as N,g as x,b as $,e as D,w as O,O as h,Q as b,R as c,N as j,A as s,G as a,U as o,_ as Se,$ as we,K as L,a2 as Me,q as ke,x as Y,p as Ae,J as M,I as K,P as Le,W as ee,H as w,T as $e,S as B,s as De,F as Re,ac as Be,V as Te,X as Ne,o as Ue,L as Fe,M as Qe}from"./vue.esm-bundler-33967e91.js";import{a as te,u as Ee}from"./ModalUpgradeRequired-a455cfd7.js";import{d6 as se,d4 as oe,dd as ze,s as J,bp as ne,dh as Ge,aq as V,dT as qe,dB as He,dQ as Ke,R as Oe,eJ as je,fv as Ye,fw as le,c4 as Je,d7 as Ve,fx as We,dS as Xe,aY as Ze,E as xe,fy as et,a2 as tt,O as st}from"./ModalPvLimitAlertView-cb9178ae.js";import{u as ae}from"./vue-i18n.cjs-bd62fc86.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";import{u as T,M as ot,_ as nt}from"./ModelContentListTable-36396f5b.js";import"./PfButton-db6d6722.js";import{u as lt}from"./BasicModal-000dc82b.js";import"./PfIconContext-bd54ca9b.js";import"./_commonjsHelpers-042e6b4d.js";import"./lodash-bf1bac5c.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./iframe-4066d2cc.js";import"../sb-preview/runtime.js";import"./PfIcon-bb1c3c10.js";import"./mapValues-a1d744f5.js";import"./Scroller-0cfa9fde.js";import"./draggable-203bb716.js";const at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAE7SURBVHgB7dxNioNAFADhp+YgcwrB1eQmkznZeJTJSvAUuYiYbpKFZCFoLTqY+iAEFBEKGn8eGCFJksqo1nYOw/DVNM05FNM0/Xddd3vdflo7KMer6/ovlP2mX/+6sQ4hBoQMCBkQMiB0ip2qqurTpf0aB5LuOM7p72fDIfsD5nht2/ZxIOM45oibArqEIQNCBoQMCBkQMiBkQMiAkAEhA0IGhHY/C6fX/d/52fFIni8TNtkdcJ7nSzrhJT6cSxgyIGRAyICQASFnIgvORCBnIgUYEDIgZEDIgJABIQNCBoQMCBkQMiDkTGTBmUgBLmHIgJABIQNCBoSciSw4E4GciRRgQMiAkAEhA0IGhAwIGRAyIGRAyICQM5EFZyIFuIQhA0IGhAwIGRBavQrnz17G48uNH+/ZQpIkvY07e2RMpuorKCsAAAAASUVORK5CYII=",it=["placeholder"],ie=N({__name:"StretchSearchInput",emits:["deselectCell"],setup(e,{emit:p}){const C=p,u=x("searchKeyword"),d=$(!1),m={height:"28px"},n=D(()=>({fontSize:"12px",paddingLeft:"30px",width:`${d.value||u?.value?128:72}px`,paddingRight:`${d.value||u?.value?16:0}px`}));return O(d,i=>{i&&C("deselectCell")}),(i,t)=>{const _=h("PfIcon"),l=h("PfRow");return a(),b(l,{class:j([[(s(d)||s(u))&&"focus"],"o-streatch-search-input _bg-white"]),style:m,align:"center",w:"full"},{default:c(()=>[o(_,{class:"_pointer-events-none _absolute _ml-8",icon:"search",color:"black",size:"16"}),Se(L("input",Me({ref:"inputRef","onUpdate:modelValue":t[0]||(t[0]=r=>ke(u)?u.value=r:null),placeholder:i.$t("CMS:Search"),style:s(n),class:"_flex-1 _bg-white _pr-16 _pl-44",name:"search-cms",type:"text"},i.$attrs,{onBlur:t[1]||(t[1]=r=>d.value=!1),onFocus:t[2]||(t[2]=r=>d.value=!0),onInput:t[3]||(t[3]=r=>i.$emit("input",r.target.value)),onKeypress:t[4]||(t[4]=r=>i.$emit("keypress",r))}),null,16,it),[[we,s(u)]])]),_:1},8,["class"])}}});const rt=G(ie,[["__scopeId","data-v-96ca9690"]]);ie.__docgenInfo={exportName:"default",displayName:"StretchSearchInput",description:"",tags:{},events:[{name:"input"},{name:"keypress"},{name:"deselectCell"}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/Cms/ModelContentList/ModelContentListController/StretchSearchInput.vue"]};const ct={class:"label-sm-bold _select-none _overflow-hidden _whitespace-nowrap"},re=N({__name:"ModelContentListControllerRight",props:{schema:{}},emits:["deselectCell"],setup(e){const p=e,C=te(),{schema:u}=Y(p),d=D(()=>u.value.id),{searchKeyword:m}=se(d),n=()=>{C.push(oe.buildContentRoute(u.value,"new"))},i=()=>{C.push({name:"PagePdDashboardCmsEditSchema"})};return Ae("searchKeyword",m),(t,_)=>{const l=h("PfIcon"),r=h("PfRow"),y=h("CanUse"),I=h("PfButton");return a(),b(r,{align:"center",class:"o-model-content-list-controller-right",gap:"16",h:"full"},{default:c(()=>[o(rt,{onDeselectCell:_[0]||(_[0]=f=>t.$emit("deselectCell"))}),o(y,{permission:t.$_enum.PermissionType.ProductEditor},{default:c(()=>[o(r,{rounded:"4",class:"_cursor-pointer _py-[6px] _px-[10px] hover:_bg-gray-50",align:"center",justfiy:"center",w:"full",gap:"4",onClick:i},{default:c(()=>[o(l,{icon:"setting"}),L("p",ct,M(t.$t("CMS:Model settings")),1)]),_:1})]),_:1},8,["permission"]),o(I,{size:"sm",variant:"primary",class:"_flex-none",onClick:n},{default:c(()=>[o(l,{icon:"plus"}),K(" "+M(t.$t("Add New")),1)]),_:1})]),_:1})}}});const ut=G(re,[["__scopeId","data-v-595099aa"]]);re.__docgenInfo={exportName:"default",displayName:"ModelContentListControllerRight",description:"",tags:{},props:[{name:"schema",required:!0,type:{name:"CmsSchema"}}],events:[{name:"deselectCell"}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/Cms/ModelContentList/ModelContentListController/ModelContentListControllerRight.vue"]};const dt={class:"_w-full"},mt=L("span",{class:"a-status-light-draft _mr-8"},null,-1),pt={class:"label-sm2-normal"},ht={class:"_w-full"},ft=L("span",{class:"a-status-light-published _mr-8"},null,-1),Ct={class:"label-sm2-normal"},ce=N({__name:"ModelContentListControllerStatusDropdown",props:{dropdownPosition:{}},emits:["publishItems","unPublishItems"],setup(e){const p=e,{dropdownPosition:C}=Y(p),{dropdownStyle:u,dropdownRef:d}=ze(C);return(m,n)=>{const i=h("PfRow"),t=h("PfDivider"),_=h("PfColumn");return a(),b(_,{ref_key:"dropdownRef",ref:d,style:Le(s(u)),class:"_absolute _w-[160px] _bg-white _py-8",gap:"8",rounded:"6",shadow:"12",onClick:n[2]||(n[2]=ee(()=>{},["stop"]))},{default:c(()=>[L("div",dt,[o(i,{align:"center",class:"hover:bg-gray _cursor-pointer _px-16 _py-8",justify:"between",w:"full",onClick:n[0]||(n[0]=l=>m.$emit("unPublishItems"))},{default:c(()=>[o(i,{align:"center",gap:"8"},{default:c(()=>[mt,L("p",pt,M(m.$t("CMS:Change to Draft")),1)]),_:1})]),_:1})]),o(t,{direction:"column"}),L("div",ht,[o(i,{align:"center",class:"hover:bg-gray _cursor-pointer _px-16 _py-8",justify:"between",w:"full",onClick:n[1]||(n[1]=l=>m.$emit("publishItems"))},{default:c(()=>[o(i,{align:"center",gap:"8"},{default:c(()=>[ft,L("p",Ct,M(m.$t("CMS:Publish")),1)]),_:1})]),_:1})])]),_:1},8,["style"])}}});ce.__docgenInfo={exportName:"default",displayName:"ModelContentListControllerStatusDropdown",description:"",tags:{},props:[{name:"dropdownPosition",required:!0,type:{name:"DropdownPosition"}}],events:[{name:"unPublishItems"},{name:"publishItems"}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/Cms/ModelContentList/ModelContentListController/ModelContentListControllerStatusDropdown.vue"]};const _t={key:0,class:"spinner black _mx-8"},gt={key:2,class:"label-sm-bold _mr-8 _opacity-50"},bt={key:3,class:"label-sm-bold _mr-8"},ue=N({__name:"ModelContentListControllerMultiplePublishButton",props:{schemaId:{}},emits:["publishItems","unPublishItems"],setup(e,{emit:p}){const C=e,u=p,{getIsSchemaProcessing:d}=T(),{processingSchema:m}=J(T()),{t:n}=ae(),{showConfirmDialog:i}=ne(),t=$(!1),_=$({top:0,left:0}),l=D(()=>m.value!==null);D(()=>d(C.schemaId));const r=async()=>{await i({text:n("CMS:multiplePublishConfirm"),label:n("CMS:Publish"),variant:"primary"})&&(t.value=!1,u("publishItems"))},y=async()=>{await i({text:n("CMS:multipleUnPublishConfirm"),label:n("CMS:Change to Draft"),variant:"destructive"})&&(t.value=!1,u("unPublishItems"))},I=f=>{if(l.value)return;const P=f.currentTarget,{bottom:R,right:v}=P.getBoundingClientRect();_.value={top:R,right:v},t.value=!0};return(f,P)=>{const R=h("PfIcon"),v=h("PfRow");return a(),b(v,{class:j([[s(l)?"_cursor-not-allowed":"hover:bg-gray _cursor-pointer"],"_mr-8 _rounded-4"]),align:"center",h:"full",justify:"center",onClick:I},{default:c(()=>[s(l)?(a(),w("span",_t)):(a(),b(R,{key:1,class:"_mx-8",icon:"changeStatus",size:"16"})),s(l)?(a(),w("p",gt,M(f.$t("CMS:changing other schema status",{schemaName:s(m).name})),1)):(a(),w("p",bt,M(f.$t("CMS:change status")),1)),o(R,{class:j([[s(l)&&"_opacity-50"],"_pr-8"]),icon:"chevronDown",size:"16"},null,8,["class"]),(a(),b($e,{to:"#teleport-cms-dashboard-overlay"},[o(Ge,null,{default:c(()=>[s(t)?(a(),w("div",{key:0,class:"_absolute _top-0 _left-0 _z-1 _h-full _w-full",onClick:P[0]||(P[0]=ee(k=>t.value=!1,["stop"]))},[o(ce,{"dropdown-position":s(_),onPublishItems:r,onUnPublishItems:y},null,8,["dropdown-position"])])):B("",!0)]),_:1})]))]),_:1},8,["class"])}}});ue.__docgenInfo={exportName:"default",displayName:"ModelContentListControllerMultiplePublishButton",description:"",tags:{},props:[{name:"schemaId",required:!0,type:{name:"string"}}],events:[{name:"publishItems"},{name:"unPublishItems"}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/Cms/ModelContentList/ModelContentListController/ModelContentListControllerMultiplePublishButton.vue"]};const vt={key:1,class:"label-sm-bold _text-gray-600"},It={key:0,class:"label-sm-bold"},yt={key:1,class:"label-sm-bold"},de=N({__name:"ModelContentListController",props:{checkedContentIdListSize:{},loadingDelete:{type:Boolean},schemaId:{}},emits:["deleteItems","publishItems","unPublishItems"],setup(e,{emit:p}){const C=e,u=p,{t:d}=ae(),m=De(C,"schemaId"),n=x("cmsSideNavigationStatus"),{showConfirmDialog:i}=ne(),{cmsSchema:t,cmsSchemaContents:_}=V({schemaId:m}),{deselectCell:l}=qe(m),{publishItemsMultipleForDebug:r}=He(m),{getIsSchemaProcessing:y}=T(),{progressContentIdCount:I}=J(T()),f=D(()=>y(m.value)),P=D(()=>f.value||C.checkedContentIdListSize>0),R=async()=>{f.value||!await i({text:d("CMS:deleteItemsConfirm",C.checkedContentIdListSize),label:d("delete"),variant:"destructive"})||u("deleteItems")};return(v,k)=>{const g=h("PfIcon"),A=h("PfRow"),Q=h("PfButton");return a(),b(A,{align:"center",class:"o-model-content-list-controller _px-24 _py-20",h:"72",justify:"between",w:"full"},{default:c(()=>[o(A,{align:"center",gap:"12",h:"full"},{default:c(()=>[s(n)==="opening"?(a(),w("button",{key:0,style:{width:"24px",height:"24px"},class:"menu-button hover:bg-gray _overflow-hidden",onClick:k[0]||(k[0]=E=>n.value="closing")},[o(g,{icon:"menuClose","icon-color":"gray-600",size:"16"})])):(a(),w("button",{key:1,style:{width:"24px",height:"24px"},class:"menu-button hover:bg-gray _overflow-hidden",onClick:k[1]||(k[1]=E=>n.value="opening")},[o(g,{icon:"menu","icon-color":"gray-600",size:"16"})])),o(A,{align:"center",gap:"12"},{default:c(()=>[s(t)?(a(),b(ot,{key:0,schema:s(t)},null,8,["schema"])):B("",!0),s(t)?(a(),w("span",vt,M(v.$t("Items",s(_).length)),1)):B("",!0)]),_:1}),v.$store.state.studioEditor.isDebugMode?(a(),b(Q,{key:2,size:"xs",variant:"primary",onClick:s(r)},{default:c(()=>[K(" Publish 100 draft items ")]),_:1},8,["onClick"])):B("",!0)]),_:1}),s(t)?(a(),b(A,{key:0,align:"center",h:"full"},{default:c(()=>[s(P)?(a(),w(Re,{key:0},[o(A,{align:"center",class:"border-r-1 _mr-8 _h-full _pr-16"},{default:c(()=>[s(f)?(a(),w("p",It,M(v.$t("CMS:multipleProcessing",s(I))),1)):(a(),w("p",yt,M(v.$t("CMS:multipleSelected",v.checkedContentIdListSize)),1))]),_:1}),o(ue,{"schema-id":s(m),onPublishItems:k[2]||(k[2]=E=>v.$emit("publishItems")),onUnPublishItems:k[3]||(k[3]=E=>v.$emit("unPublishItems"))},null,8,["schema-id"]),o(Q,{disabled:s(f),loading:v.loadingDelete,size:"sm",variant:"destructive",onClick:R},{default:c(()=>[o(g,{icon:"dustbox"}),K(" "+M(v.$t("CMS:Delete Items")),1)]),_:1},8,["disabled","loading"])],64)):(a(),b(ut,{key:1,schema:s(t),onDeselectCell:s(l)},null,8,["schema","onDeselectCell"]))]),_:1})):B("",!0)]),_:1})}}});const Pt=G(de,[["__scopeId","data-v-4156309a"]]);de.__docgenInfo={exportName:"default",displayName:"ModelContentListController",description:"",tags:{},props:[{name:"checkedContentIdListSize",required:!0,type:{name:"number"}},{name:"loadingDelete",required:!0,type:{name:"boolean"}},{name:"schemaId",required:!0,type:{name:"string"}}],events:[{name:"publishItems"},{name:"unPublishItems"},{name:"deleteItems"}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/Cms/ModelContentList/ModelContentListController/ModelContentListController.vue"]};const St=()=>{const{getCurrentPublishAllowedCount:e,publishContent:p,unPublishContent:C}=Ke(),{cmsProjectId:u}=Oe(),{segmentProjectCmsItemMultiPublished:d}=je(),{startProcessing:m,removeProcessFinishedContentIdFromList:n}=T(),i=Je();return{publishMultiple:async(l,r)=>{m(l,r),d();const y=i.getters["CmsStore/findSchemaById"](l),I=e();if(!await Ye.getIfPublishAvailable({limit:I,projectId:u.value,schemaPostType:y.postType,publishCount:r.length}))throw new Error(le.OverPlanLimitaion);for(const f of r)try{await p({schemaId:l,contentId:f}),n(f)}catch(P){console.error("publish Multiple failed with",f,P)}},unPublishMultiple:async(l,r)=>{m(l,r);const y=(I,f)=>new Promise(P=>{setTimeout(()=>{n(I),P()},f)});for(const I of r)await C({schemaId:l,contentId:I}),await y(I,150)}}},me=N({name:"ModelContentList",components:{ModelContentListTable:nt,ModelContentListController:Pt,PfSnackbar:Ve},props:{schemaId:{type:String,required:!0}},setup(e){const{schemaId:p}=Y(e),{othersSessions:C}=We(),{cmsSchema:u,contentIdList:d,filteredContents:m,isPostSchema:n,isUserSchema:i}=V({schemaId:p}),{deleteContent:t,deleteContents:_}=Xe(),{fieldKeyList:l,listWidth:r,query:y}=se(p),{publishMultiple:I,unPublishMultiple:f}=St(),{finishProcessing:P}=T(),{progressContentIdCount:R}=J(T()),{currentPlanType:v}=Ze(),k=lt(),g=$([]),A=$(!1),Q=D(()=>y.value.hasQuery),E=D(()=>!n.value&&!Q.value),z=$(!1),q=$(!1),H=$(!1),W=4e3,fe=async(S,U)=>{A.value=!0;try{await t(S,U)}catch(F){console.error(F)}finally{A.value=!1}g.value=g.value.filter(F=>F!==U)},Ce=async()=>{A.value=!0;try{await _(p.value,g.value)}catch(S){console.error(S)}finally{A.value=!1}g.value=[]},_e=async()=>{z.value=!1;const S=g.value;g.value=[];try{await I(p.value,S),ge()}catch(U){const F=xe(U);if(F===le.OverPlanLimitaion){const Z=et(v.value);Z&&k.push(Z)}else console.error(F)}P()},ge=()=>{q.value=!0,setTimeout(()=>{q.value=!1},W)},be=async()=>{z.value=!1;const S=g.value;g.value=[];try{await f(p.value,S)}catch(U){console.error(U)}finally{P()}ve()},ve=()=>{H.value=!0,setTimeout(()=>{H.value=!1},W)},Ie=S=>{S?g.value=d.value:g.value=[]},ye=()=>{H.value=!1,q.value=!1},X=$(null),Pe=D(()=>({height:`calc(100% - ${X.value?.$el.clientHeight}px)`}));return O(p,()=>{g.value=[]}),O(g,S=>{d.value.length&&S.length===d.value.length?z.value=!0:z.value=!1}),{checkedContentIdList:g,cmsSchema:u,contentIdList:d,deleteItem:fe,deleteItems:Ce,publishItems:_e,unPublishItems:be,checkAllContents:Ie,fieldKeyList:l,filteredContents:m,isQuerying:Q,isSortable:E,isUserSchema:i,isAllChecked:z,isPublishToast:q,isUnPublishToast:H,listWidth:r,loadingDelete:A,modelContentListControllerRef:X,othersSessions:C,progressContentIdCount:R,scrollWrapStyle:Pe,closeToast:ye}}}),wt={class:"o-model-content-list _h-full _w-full"};function Mt(e,p,C,u,d,m){const n=h("ModelContentListController"),i=h("ModelContentListTable"),t=h("router-view"),_=h("PfSnackbar");return a(),w("div",wt,[o(n,{ref:"modelContentListControllerRef","checked-content-id-list-size":e.checkedContentIdList.length,"loading-delete":e.loadingDelete,"schema-id":e.schemaId,onDeleteItems:e.deleteItems,onPublishItems:e.publishItems,onUnPublishItems:e.unPublishItems},null,8,["checked-content-id-list-size","loading-delete","schema-id","onDeleteItems","onPublishItems","onUnPublishItems"]),e.cmsSchema?(a(),b(i,{key:0,checkedContentIdList:e.checkedContentIdList,"onUpdate:checkedContentIdList":p[0]||(p[0]=l=>e.checkedContentIdList=l),"cms-schema":e.cmsSchema,"content-id-list":e.contentIdList,"field-key-list":e.fieldKeyList,"filtered-contents":e.filteredContents,"is-querying":e.isQuerying,"is-sortable":e.isSortable,"is-user-schema":e.isUserSchema,"is-all-check-header":e.isAllChecked,"list-width":e.listWidth,"scroll-wrap-style":e.scrollWrapStyle,onDeleteItem:e.deleteItem,onCheckAllContents:e.checkAllContents},null,8,["checkedContentIdList","cms-schema","content-id-list","field-key-list","filtered-contents","is-querying","is-sortable","is-user-schema","is-all-check-header","list-width","scroll-wrap-style","onDeleteItem","onCheckAllContents"])):B("",!0),o(t,null,{default:c(({Component:l})=>[o(Te,null,{default:c(()=>[(a(),b(Ne(l),{class:"_z-2"}))]),_:2},1024)]),_:1}),o(Be,null,{default:c(()=>[e.isPublishToast?(a(),b(_,{key:0,icon:"roundCheck",msg:`${e.$t("CMS:multiplePublishFinished",e.progressContentIdCount)}`,"on-click":e.closeToast},null,8,["msg","on-click"])):B("",!0),e.isUnPublishToast?(a(),b(_,{key:1,icon:"roundCheck",msg:`${e.$t("CMS:multipleUnPublishFinished",e.progressContentIdCount)}`,"on-click":e.closeToast},null,8,["msg","on-click"])):B("",!0)]),_:1})])}const kt=G(me,[["render",Mt]]);me.__docgenInfo={displayName:"ModelContentList",exportName:"default",description:"",tags:{},props:[{name:"schemaId",type:{name:"string"},required:!0}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/Cms/ModelContentList/ModelContentList.vue"]};const pe=e=>(Fe("data-v-a626f4d3"),e=e(),Qe(),e),At={class:"page-dashboard-cms _h-full"},Lt=pe(()=>L("img",{alt:"database",src:at,width:"40"},null,-1)),$t={class:"_heading-sm"},Dt=pe(()=>L("div",{id:"teleport-cms-dashboard-overlay"},null,-1)),he=N({__name:"PageDashboardCms",setup(e){const p=te(),C=Ee(),u=tt("schemaId"),{isCmsStoreSchemasReady:d}=V({schemaId:u}),{hasCms:m}=st(),n=$(!1),i=()=>{p.push(oe.buildCreateSchemaRoute())};return Ue(()=>{!m.value&&C.name!=="PagePdDashboardCmsSetup"&&p.replace({name:"PagePdDashboardCmsSetup"}),n.value=!0}),(t,_)=>{const l=h("PfButton"),r=h("PfColumn"),y=h("PfRow");return a(),w("div",At,[s(n)&&s(d)&&s(u)?(a(),b(kt,{key:0,"schema-id":s(u)},null,8,["schema-id"])):(a(),b(y,{key:1,align:"center",class:"_bg-white",h:"full",justify:"center",w:"full"},{default:c(()=>[o(r,{align:"center",gap:"32"},{default:c(()=>[Lt,o(r,{align:"center",gap:"16"},{default:c(()=>[L("span",$t,M(t.$t("CmsNoModel: msg")),1),o(l,{onClick:i},{default:c(()=>[K(M(t.$t("CmsNoModel: btn")),1)]),_:1})]),_:1})]),_:1})]),_:1})),Dt])}}});const Wt=G(he,[["__scopeId","data-v-a626f4d3"]]);he.__docgenInfo={exportName:"default",displayName:"PageDashboardCms",description:"",tags:{},sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/Pd/PdDashboard/PageDashboardCms.vue"]};export{Wt as default};
