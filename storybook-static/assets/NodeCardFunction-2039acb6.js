import{_ as x}from"./iframe-4066d2cc.js";import{f as M,ah as R,x as E,b as A,G as i,H as c,U as H,A as k,N as I,e as m,o as T,F as U,K as f,O as B,Z as G,Q as S,S as z,L as K,M as Q}from"./vue.esm-bundler-33967e91.js";import{u as W}from"./draggable-203bb716.js";import{b as $,c as V,e as X}from"./Editor-e2ebb077.js";import{ar as D,bN as Y}from"./ModalPvLimitAlertView-cb9178ae.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import{N as Z}from"./NodeCardBackground-e1c3a5e9.js";import"../sb-preview/runtime.js";import"./ModalUpgradeRequired-a455cfd7.js";import"./BasicModal-000dc82b.js";import"./PfButton-db6d6722.js";import"./PfIconContext-bd54ca9b.js";import"./lodash-bf1bac5c.js";import"./_commonjsHelpers-042e6b4d.js";import"./vue-i18n.cjs-bd62fc86.js";import"./SelectSwitch-b6107958.js";import"./tiptap-extension-paragraph.esm-72054cce.js";import"./PfIcon-bb1c3c10.js";import"./ApiIcon-4990672b.js";import"./useSearch-b8b0ad67.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./mapValues-a1d744f5.js";const j=M({__name:"NodeAddHandle",props:{node:{type:Object,required:!0},cardNode:{type:Object,required:!0}},setup(e){const n=e,_=R(()=>x(()=>import("./Editor-e2ebb077.js").then(a=>a.j),["./Editor-e2ebb077.js","./vue.esm-bundler-33967e91.js","./ModalPvLimitAlertView-cb9178ae.js","./vue-i18n.cjs-bd62fc86.js","./_commonjsHelpers-042e6b4d.js","./ModalUpgradeRequired-a455cfd7.js","./BasicModal-000dc82b.js","./_plugin-vue_export-helper-c27b6911.js","./BasicModal-276b42ea.css","./PfButton-db6d6722.js","./PfIconContext-bd54ca9b.js","./ModalUpgradeRequired-1a015d77.css","./lodash-bf1bac5c.js","./_commonjs-dynamic-modules-302442b1.js","./iframe-4066d2cc.js","./PfIcon-bb1c3c10.js","./mapValues-a1d744f5.js","./ModalPvLimitAlertView-c58a5858.css","./SelectSwitch-b6107958.js","./tiptap-extension-paragraph.esm-72054cce.js","./SelectSwitch-74fee1e2.css","./draggable-203bb716.js","./ApiIcon-4990672b.js","./ApiIcon-f6bf5922.css","./useSearch-b8b0ad67.js","./Editor-f05e9ae1.css"],import.meta.url)),{node:p}=E(n),{selectedNodeId:o,hoveredNodeId:s,draggingNode:t,addNode:N,updateNode:y,scrollAdjust:h,zoom:d}=$(),C=D(()=>p.value.id===o.value),b=A(null),g=A({x:0,y:0}),l=A(null),w=D(()=>!!t.value&&t.value?.id===l.value?.id);return W(b,{start:a=>{a.stopPropagation(),g.value={x:(a.clientX-window.innerWidth/2+h.value.x)/d.value,y:(a.clientY-(window.innerHeight+95)/2+h.value.y)/d.value}},change:({x:a,y:u})=>{l.value?y(l.value.id,{position:{x:g.value.x+Math.round(a/d.value),y:g.value.y+Math.round(u/d.value)}}):(l.value=N(p.value)[0],o.value=l.value.id,t.value=l.value)},end:a=>{l.value&&(t.value=null,l.value=null)}}),(a,u)=>(i(),c("div",{ref_key:"el",ref:b,class:I(["NodeAddHandle",[k(p).type,{isSelected:k(C),isDragging:k(w)}]]),onMouseenter:u[0]||(u[0]=v=>s.value=k(p).id),onMouseleave:u[1]||(u[1]=v=>s.value="")},[H(k(_),{node:e.cardNode},null,8,["node"])],34))}});const J=F(j,[["__scopeId","data-v-6471449b"]]);j.__docgenInfo={exportName:"default",displayName:"NodeAddHandle",description:"",tags:{},props:[{name:"node",type:{name:"BlueprintNode"},required:!0},{name:"cardNode",type:{name:"BlueprintNode"},required:!0}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/BlueprintEditor/NodeAddHandle.vue"]};const ee={class:"ArgInput"},ne={viewBox:"0 0 45 25",fill:"none",xmlns:"http://www.w3.org/2000/svg"},oe=["d"],te=["d"],L=M({__name:"ArgInput",props:{node:{type:Object,required:!1,default:null},allowType:{type:String,required:!1,default:"number"}},emits:["update"],setup(e,{emit:n}){const _=e,p=n,{node:o,allowType:s}=E(_),{draggingNode:t,isUsed:N,findChildIds:y,findAncestorIds:h,addNodeFromSeed:d}=$(),C=m(()=>o.value&&t.value&&N(o.value.id)?!(t.value.id===o.value.id||y(t.value.id).includes(o.value.id)):!1),b=u=>{const v={type:"argument",label:u.value,args:[{type:"valueType",value:"any"}]},r=d(v);p("update",r[0].id),u.value="",u.blur()},g=()=>{o.value&&t.value&&t.value.id!==o.value.id&&p("update",t.value.id)},l=m(()=>V(45,25)),w=m(()=>s.value==="boolean"),a=A(null);return T(()=>{requestAnimationFrame(()=>{a.value.focus()})}),(u,v)=>(i(),c("div",ee,[w.value?(i(),c(U,{key:0},[f("input",{ref_key:"inputRef",ref:a,class:I(["boolean-value-input",[{canDrop:C.value},k(s)]]),onChange:v[0]||(v[0]=r=>b(r.target)),onMouseup:g},null,34),(i(),c("svg",ne,[f("path",{d:l.value,class:"svg-bg"},null,8,oe),f("path",{d:l.value,class:"svg-border"},null,8,te)]))],64)):(i(),c("input",{key:1,ref_key:"inputRef",ref:a,class:I(["value-input",[{canDrop:C.value},k(s)]]),onChange:v[1]||(v[1]=r=>b(r.target)),onMouseup:g},null,34))]))}});const de=F(L,[["__scopeId","data-v-67b56ff7"]]);L.__docgenInfo={exportName:"default",displayName:"ArgInput",description:"",tags:{},props:[{name:"node",type:{name:"BlueprintNode"},required:!1,defaultValue:{func:!1,value:"null"}},{name:"allowType",type:{name:"string"},required:!1,defaultValue:{func:!1,value:"'number'"}}],events:[{name:"update"}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/BlueprintEditor/NodeCard/ArgInput.vue"]};const O=M({name:"NodeCardFunction",props:{node:{type:Object,required:!0}},components:{ArgInput:de,NodeCardBackground:Z,NodeAddHandle:J,NodeHandle:R(()=>x(()=>import("./Editor-e2ebb077.js").then(e=>e.k),["./Editor-e2ebb077.js","./vue.esm-bundler-33967e91.js","./ModalPvLimitAlertView-cb9178ae.js","./vue-i18n.cjs-bd62fc86.js","./_commonjsHelpers-042e6b4d.js","./ModalUpgradeRequired-a455cfd7.js","./BasicModal-000dc82b.js","./_plugin-vue_export-helper-c27b6911.js","./BasicModal-276b42ea.css","./PfButton-db6d6722.js","./PfIconContext-bd54ca9b.js","./ModalUpgradeRequired-1a015d77.css","./lodash-bf1bac5c.js","./_commonjs-dynamic-modules-302442b1.js","./iframe-4066d2cc.js","./PfIcon-bb1c3c10.js","./mapValues-a1d744f5.js","./ModalPvLimitAlertView-c58a5858.css","./SelectSwitch-b6107958.js","./tiptap-extension-paragraph.esm-72054cce.js","./SelectSwitch-74fee1e2.css","./draggable-203bb716.js","./ApiIcon-4990672b.js","./ApiIcon-f6bf5922.css","./useSearch-b8b0ad67.js","./Editor-f05e9ae1.css"],import.meta.url))},setup(e){const{node:n}=E(e),{findNode:_,selectedNodeId:p,draggingNode:o,updateNode:s,isUsed:t,findChildIds:N}=$(),y=m(()=>n.value.args.map(r=>{const q=_(r),P=Y.create({type:"variable",value:q.value})[0];return{argNode:q,variable:P}})),h=m(()=>n.value.children.map(r=>_(r))),d=m(()=>o.value?.id===n.value.id?!1:n.value.id===p.value||n.value.children.includes(p.value)),C=()=>{o.value&&o.value.id!==n.value.id&&(s(o.value.id,{position:null}),s(n.value.id,{args:[...n.value.args,o.value.id]}))},b=r=>{if(o.value&&o.value.id!==n.value.id){if(N(o.value.id).includes(n.value.id))return!1;s(o.value.id,{position:null}),s(n.value.id,{children:[o.value.id]})}},g=r=>{p.value=r.id},l=r=>{s(r,{position:null}),s(n.value.id,{args:[...n.value.args||[],r]})},{nodeResult:w}=X(m(()=>n.value.args[0])),a=m(()=>V(45,25)),u=m(()=>t(n.value.id)),v=A(!1);return{children:h,args:y,canSelectChildren:d,onChildMouseup:b,onMouseup:C,borderPath:a,nodeResult:w,showChildren:u,onClick:g,updateArg:l,isEditing:v}}});const ae=e=>(K("data-v-dee8f778"),e=e(),Q(),e),re={class:"container"},se=["onClick"],le=ae(()=>f("svg",{class:"arrow-icon",width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[f("path",{d:"M7.5 1V14M7.5 14L3 9.5M7.5 14L12 9.5",stroke:"#808080"})],-1)),ue={class:"children-container"},ie={key:0,class:"material-icons"},pe={key:1,class:"material-icons"};function ce(e,n,_,p,o,s){const t=B("NodeAddHandle"),N=B("ArgInput"),y=B("NodeHandle"),h=B("NodeCardBackground");return i(),c("div",{class:I(["NodeCardFunction",{canSelectChildren:e.canSelectChildren}])},[f("div",re,[(i(!0),c(U,null,G(e.args,d=>(i(),c("div",{key:d.argNode.id,class:"node-frame",onClick:C=>e.onClick(d.argNode)},[H(t,{node:d.variable,"card-node":d.argNode},null,8,["node","card-node"])],8,se))),128)),e.isEditing?(i(),S(N,{key:0,node:e.node,onUpdate:e.updateArg},null,8,["node","onUpdate"])):z("",!0)]),le,f("div",ue,[f("div",{class:I(["node-frame left",{active:!e.nodeResult,noChild:!e.children[0]}])},[e.children[0]?(i(),S(y,{key:0,node:e.children[0]},null,8,["node"])):(i(),c("div",{key:1,class:"empty",onMouseup:n[0]||(n[0]=d=>e.onChildMouseup(0))},null,32))],2)]),H(h,{node:e.node},null,8,["node"]),f("button",{class:"edit-button",onMousedown:n[1]||(n[1]=d=>e.isEditing=!e.isEditing)},[e.isEditing?(i(),c("i",ie,"check")):(i(),c("i",pe,"edit"))],32)],2)}const De=F(O,[["render",ce],["__scopeId","data-v-dee8f778"]]);O.__docgenInfo={displayName:"NodeCardFunction",exportName:"default",description:"",tags:{},props:[{name:"node",type:{name:"BlueprintNode"},required:!0}],sourceFiles:["/Users/h.kamiyama/GitHub/studio-front/src/components/BlueprintEditor/NodeCard/NodeCardFunction.vue"]};export{De as default};
